<!DOCTYPE html>
<html dir="rtl" lang="ku">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aviatrix Official Pro</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <style>
        :root { --red: #ea1d5d; --bg: #0b0e11; --panel: #1e2329; }
        body { margin: 0; background: var(--bg); color: white; font-family: sans-serif; overflow: hidden; height: 100vh; display: flex; flex-direction: column; }
        .header { padding: 15px; background: var(--panel); display: flex; justify-content: space-between; border-bottom: 2px solid var(--red); }
        .game-area { flex-grow: 1; position: relative; background: radial-gradient(circle, #1e2329, #0b0e11); overflow: hidden; }
        /* ⁄Øÿ±€åÿØ€å ÿ¨Ÿà⁄µÿßŸà */
        .game-area::before { content: ""; position: absolute; width: 200%; height: 200%; background-image: linear-gradient(rgba(255,255,255,0.05) 1px, transparent 1px), linear-gradient(90deg, rgba(255,255,255,0.05) 1px, transparent 1px); background-size: 50px 50px; z-index: 1; }
        #multiplier { position: absolute; top: 35%; left: 50%; transform: translate(-50%, -50%); font-size: 80px; font-weight: 900; color: #f0b90b; z-index: 10; text-shadow: 0 0 20px rgba(240, 185, 11, 0.4); }
        #plane { position: absolute; font-size: 55px; z-index: 20; transform: translate(-50%, -50%); transition: 0.1s linear; filter: drop-shadow(0 0 10px var(--red)); }
        canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; }
        .controls { background: var(--panel); padding: 30px; border-radius: 35px 35px 0 0; text-align: center; z-index: 100; box-shadow: 0 -10px 20px rgba(0,0,0,0.5); }
        .btn { width: 90%; padding: 20px; font-size: 24px; font-weight: bold; border-radius: 15px; border: none; cursor: pointer; transition: 0.2s; }
        .btn-bet { background: #22c55e; color: white; box-shadow: 0 5px 0 #168a42; }
        .btn-cash { background: var(--red); color: white; display: none; box-shadow: 0 5px 0 #b0134a; }
        input { padding: 15px; border-radius: 10px; border: 1px solid #444; background: #000; color: white; text-align: center; margin-bottom: 15px; width: 160px; font-size: 20px; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-weight: 900; color: var(--red); font-size: 20px;">AVIATRIX</div>
        <div style="color: #f0b90b; font-weight: bold;">üí∞ <span id="balance">0</span> IQD</div>
    </div>

    <div class="game-area" id="stage">
        <canvas id="graphCanvas"></canvas>
        <div id="multiplier">1.00x</div>
        <div id="plane">‚úàÔ∏è</div>
    </div>

    <div class="controls">
        <input type="number" id="betInput" value="1000"> <br>
        <button id="betBtn" class="btn btn-bet" onclick="startGame()">BET (⁄Øÿ±€ïŸà⁄©ÿ±ÿØŸÜ)</button>
        <button id="cashBtn" class="btn btn-cash" onclick="cashOut()">CASH OUT (Ÿà€ïÿ±⁄Øÿ±ÿ™ŸÜ€ïŸà€ï)</button>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDCwv_kg1O3kiV4qkQjZnZHEWCrOMCH6W4",
            authDomain: "kurdex-pro-fa38c.firebaseapp.com",
            projectId: "kurdex-pro-fa38c",
            storageBucket: "kurdex-pro-fa38c.firebasestorage.app",
            messagingSenderId: "900983839878",
            appId: "1:900983839878:web:b445bdf15aebb1a0d68507"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();

        let balance = 0;
        let isPlaying = false;
        let currentX = 1.00;
        let gameLoop;
        let points = [];
        
        // ÿØ€ïŸÜ⁄Ø€ï⁄©ÿßŸÜ
        const crashSound = new Audio('https://www.soundjay.com/buttons/sounds/bomb-02.mp3');
        const winSound = new Audio('https://www.soundjay.com/buttons/sounds/coin-01.mp3');

        const canvas = document.getElementById('graphCanvas');
        const ctx = canvas.getContext('2d');

        function resize() {
            canvas.width = window.innerWidth;
            canvas.height = document.getElementById('stage').offsetHeight;
        }
        window.onresize = resize;
        resize();

        auth.onAuthStateChanged(user => {
            if (user) {
                db.collection("wallets").doc(user.uid).onSnapshot(doc => {
                    if (doc.exists) {
                        balance = Number(doc.data().balance);
                        document.getElementById('balance').innerText = balance.toLocaleString();
                    }
                });
            }
        });

        function startGame() {
            let bet = Number(document.getElementById('betInput').value);
            if (bet > balance || bet < 100) { alert("ÿ®ÿß⁄µÿßŸÜÿ≥ÿ™ ÿ®€ïÿ¥ ŸÜÿß⁄©ÿßÿ™!"); return; }
            
            balance -= bet;
            updateDB();
            isPlaying = true;
            currentX = 1.00;
            points = [];
            
            document.getElementById('betBtn').style.display = 'none';
            document.getElementById('cashBtn').style.display = 'inline-block';
            document.getElementById('multiplier').style.color = "#f0b90b";

            let crashPoint = (Math.random() * 5 + 1.05).toFixed(2);

            gameLoop = setInterval(() => {
                currentX += 0.01;
                document.getElementById('multiplier').innerText = currentX.toFixed(2) + "x";
                
                let x = (currentX - 1) * (canvas.width / 4);
                let y = canvas.height - ((currentX - 1) * (canvas.height / 3.5)) - 80;
                points.push({x, y});

                ctx.clearRect(0,0, canvas.width, canvas.height);
                ctx.beginPath();
                ctx.strokeStyle = "#ea1d5d";
                ctx.lineWidth = 7;
                ctx.lineJoin = "round";
                ctx.shadowBlur = 10;
                ctx.shadowColor = "#ea1d5d";
                for(let i=0; i<points.length; i++) {
                    if(i===0) ctx.moveTo(points[i].x, points[i].y);
                    else ctx.lineTo(points[i].x, points[i].y);
                }
                ctx.stroke();

                let p = document.getElementById('plane');
                p.style.left = x + "px";
                p.style.top = y + "px";

                if (currentX >= crashPoint) { 
                    crashSound.play();
                    stopGame("ÿ™€ïŸÇ€å€å€ïŸà€ï! üí•", true); 
                }
            }, 60);
        }

        function cashOut() {
            if (!isPlaying) return;
            winSound.play();
            let bet = Number(document.getElementById('betInput').value);
            balance += Math.floor(bet * currentX);
            updateDB();
            stopGame("Ÿæ€åÿ±€Üÿ≤€ï! Ÿæÿßÿ±€ï⁄©€ïÿ™ ÿ®ÿ±ÿØ€ïŸà€ï üöÄ", false);
        }

        function stopGame(msg, crashed) {
            clearInterval(gameLoop);
            isPlaying = false;
            if(crashed) document.getElementById('multiplier').style.color = "red";
            setTimeout(() => { alert(msg); }, 150);
            document.getElementById('betBtn').style.display = 'inline-block';
            document.getElementById('cashBtn').style.display = 'none';
        }

        function updateDB() {
            const user = auth.currentUser;
            if (user) db.collection("wallets").doc(user.uid).update({ balance: balance });
        }
    </script>
</body>
</html>
